<div class="table-container">
    <table class="spaced-table">
        <tr>
            <th rowspan="2">ID</th>
            <th rowspan="2">Avatar</th>
            <th rowspan="2">Display Name</th>
            <th rowspan="2">Bio</th>
            <th rowspan="2">Actions</th>
            <th colspan="<?= count(${basename(__FILE__, '.phtml') . '_roles'}) ?>" dir="ltr">Roles</th>
        </tr>
        <tr>
            <?php for ($i = 0; $i < count(${basename(__FILE__, '.phtml') . '_roles'}); $i++):
                $headerRole = ${basename(__FILE__, '.phtml') . '_roles'}[$i];
                $headerRoleColor = preg_match('/^[0-9a-fA-F]{3,6}$/', $headerRole->color) ? $headerRole->color : 'cccccc';
            ?>
                <th class="role-header"
                    style="background-color: #<?= $headerRoleColor ?>;" dir="ltr">
                    <?= htmlspecialchars($headerRole->name, ENT_QUOTES, 'UTF-8') ?>
                </th>
            <?php endfor; ?>
        </tr>
        <?php foreach (${basename(__FILE__, '.phtml') . '_accounts'} as $user): ?>
            <tr data-user-id="<?= htmlspecialchars($user->getId(), ENT_QUOTES, 'UTF-8') ?>">
                <td class="userinfo"><?= htmlspecialchars($user->getId(), ENT_QUOTES, 'UTF-8') ?></td>
                <td><img class="avatar" src="<?= htmlspecialchars($user->getAvatarLink(), ENT_QUOTES, 'UTF-8') ?>"
                        onerror="this.onerror=null; this.src='<?= htmlspecialchars($user->getDefaultAvatarUrl(), ENT_QUOTES, 'UTF-8') ?>'"
                        alt="Profile picture" loading="lazy" /></td>
                <td class="userinfo"><?= htmlspecialchars($user->getName(), ENT_QUOTES, 'UTF-8') ?></td>
                <td class="userinfo txt-l"><a href="/cast/<?= htmlspecialchars($user->getId(), ENT_QUOTES, 'UTF-8') ?>#bio"
                        target="_blank">Bio User
                        <?= htmlspecialchars($user->getId(), ENT_QUOTES, 'UTF-8') ?></a></td>
                <td class="buttons-column">
                    <span class="reset-password-link"><button class="resetpasswordbtn lb-a">Reset
                            Password</button></span>
                    <a class="manage-account-link btn manageaccbtn"
                        href="/account/<?= htmlspecialchars($user->getId(), ENT_QUOTES, 'UTF-8') ?>">Manage Account</a>
                    <span class="clear-bio-link"><button class="clearbiobtn lb-a">Clear Bio</button></span>
                    <span class="clear-avatar-link"><button class="clearavatarbtn lb-a">Clear Avatar</button></span>
                    <span class="delete-account-link"><button class="deletebtn">Delete account</button></span>
                </td>
                <?php
                $roles = ${basename(__FILE__, '.phtml') . '_roles'};
                foreach ($roles as $role):
                    $roleId = htmlspecialchars($role->getId(), ENT_QUOTES, 'UTF-8');
                    $roleName = htmlspecialchars($role->name, ENT_QUOTES, 'UTF-8');
                    $roleColor = htmlspecialchars($role->color, ENT_QUOTES, 'UTF-8');
                    $inputId = 'role-checkbox-' . htmlspecialchars($user->getId(), ENT_QUOTES, 'UTF-8') . '-' . $roleId;
                ?>
                    <td class="role-column"
                        style="background-color: #<?= $roleColor ?>">
                        <input type="checkbox" id="<?= $inputId ?>" aria-label="<?= $roleName ?>"
                            <?= $user->hasRole($role->name) ? 'checked' : '' ?> data-role-id="<?= $roleId ?>"
                            class="checkbox-large">
                    </td>
                <?php endforeach; ?>
            </tr>
        <?php endforeach; ?>
    </table>
</div>