<script>
    var npcId = <?= ${basename(__FILE__, '.phtml').'_recording'}->npcId ?>;
    var voiceActorId = <?= ${basename(__FILE__, '.phtml').'_voice_actor_id'} ?>;
    var userId = "<?= @${basename(__FILE__, '.phtml').'_user_id'} ?>";
    var userName = "<?= @${basename(__FILE__, '.phtml').'_user_name'} ?>";
    var userAvatar = "<?= @${basename(__FILE__, '.phtml').'_user_avatar'} ?>";
</script>

<!-- Hero Section -->
<div class="comments-hero">
    <div class="comments-hero-content">
        <h1 class="comments-hero-title">Comment Section</h1>
        <h3 class="comments-hero-subtitle"><?= ${basename(__FILE__, '.phtml').'_recording_title'} ?></h3>

        <?php $audioSrc = \VoicesOfWynn\storageUrl('recordings/' . ${basename(__FILE__, '.phtml').'_recording'}->file); ?>
        <?php include 'Views/partials/audio-player.phtml'; ?>
    </div>
</div>

<!-- Action Buttons -->
<div class="comments-action-buttons">
    <button id="new-comment-button" class="comments-toggle-btn">Post new Comment</button>
    <button id="hide-form-button" class="comments-toggle-btn">Hide the form</button>
</div>

<!-- Comment Form -->
<div class="comments-form-card">
    <form method="post" data-recording-id="<?= ${basename(__FILE__, '.phtml').'_recording'}->id ?>">
        <fieldset class="comment-writing-form">

            <?php if (${basename(__FILE__, '.phtml').'_logged_in'}) : ?>
            <div class="comment-tabs">
                <div id="contributor-option" class="comment-tab selected as-contributor">Post as a contributor</div>
                <div id="guest-option" class="comment-tab as-guest">Post as a guest</div>
            </div>

            <div id="contributor-form" class="comment-form-wrapper">
                <fieldset class="comment-field">
                    <label for="content-contributor" class="comment-label">Comment:</label>
                    <textarea id="content-contributor" class="comment-textarea" placeholder="You can praise the voice actor, suggest what could be improved or just say how much you like this quest. Just please, keep bad words out of that ðŸ˜‰"></textarea>
                </fieldset>
                <input type="submit" class="comment-submit-btn" value="Send" />
                <small class="comment-disclaimer">
                    Name and contents of the comment will be publicly visible.<br>
                    The comment will be linked to your account and you'll be able to delete it anytime.
                </small>
            </div>
            <?php endif ?>

            <div id="guest-form" <?php if (${basename(__FILE__, '.phtml').'_logged_in'}) : ?>class="display-none"<?php endif ?>>
                <?php if (!${basename(__FILE__, '.phtml').'_logged_in'}) : ?>
                    <span class="comment-disclaimer">Are you a contributor? You can post a verified comment after <a href="login">logging in</a>.</span>
                <?php endif ?>
                <fieldset class="comment-field">
                    <label for="name" class="comment-label">Name:</label>
                    <input id="name" type="text" class="comment-input" placeholder="Anonymous" />

                    <label for="email" class="comment-label">E-mail:</label>
                    <input id="email" type="text" class="comment-input" placeholder="Used to get Gravatar; not required" />

                    <label for="content-guest" class="comment-label">Comment:</label>
                    <textarea id="content-guest" class="comment-textarea" placeholder="You can praise the voice actor, suggest what could be improved or just say how much you like this quest. Just please, keep bad words out of that ðŸ˜‰"></textarea>
                </fieldset>

                <label for="antispam" class="comment-label antispam-label">Not a robot? Then you can select some shade of <strong style="color:<?= ${basename(__FILE__, '.phtml').'_antispam_color_code'} ?>;"><?= ${basename(__FILE__, '.phtml').'_antispam_color'} ?></strong>, right?</label>
                <input id="antispam" type="color" class="comment-antispam" required />

                <input type="submit" class="comment-submit-btn" value="Send" />
                <small class="comment-disclaimer">
                    Name and contents of the comment will be publicly visible.<br>
                    You will be able to delete this comment only from this IP.<br>
                    Your IP and e-mail addresses and will be stored, but will never be publicly visible.
                </small>
            </div>

        </fieldset>
    </form>
</div>

<!-- Comments List -->
<div id="comments" class="comments-list">
    <?php foreach (${basename(__FILE__, '.phtml').'_comments'} as $comment) : ?>
    <div class="comment-card" id="c<?= $comment->id ?>">
        <div class="comment-header">
            <img src="<?= $comment->getAvatar() ?>" alt="Avatar" class="comment-avatar"/>
            <div class="comment-author-info">
                <div class="comment-author-name">
                    <?php if ($comment->verified) : ?>
                        <a href="cast/<?= $comment->userId ?>"><?= $comment->getName() ?></a>
                    <?php else : ?>
                        <?= $comment->getName() ?>
                    <?php endif ?>
                </div>
                <div class="comment-badges">
                    <?php if ($comment->verified) : ?>
                        <?php if ($comment->userId === ${basename(__FILE__, '.phtml').'_voice_actor_id'}) : ?>
                            <span class="author-badge" title="This user is the author of this recording.">Author</span>
                        <?php endif ?>
                        <span class="contributor-badge" title="This user contributed to this project.">Contributor</span>
                    <?php endif ?>
                </div>
            </div>
            <?php if (${basename(__FILE__, '.phtml').'_admin'} || in_array($comment->id, ${basename(__FILE__, '.phtml').'_owned_comments'})) : ?>
                <button data-comment-id="<?= $comment->id ?>" class="delete-comment-button" title="Delete comment">Ã—</button>
            <?php endif ?>
        </div>
        <hr class="comment-separator">
        <div class="comment-content">
            <p><?= $comment->content ?></p>
        </div>
    </div>
    <?php endforeach ?>
</div>

<!-- Back Button -->
<div class="back-btn-container">
    <button class="backbtn" onclick="history.go(-1)">< Go Back</button>
</div>
