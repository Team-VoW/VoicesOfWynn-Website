<header class="credits-header">
    <h1>Contributors</h1>
    <p>A lot of people worked hard on this mod. Take a moment to appreciate their work.</p>
</header>

<?php
$currentRole = null;
foreach (${basename(__FILE__, '.phtml') . '_contributors'} as $contributor):
    $roles = $contributor->getRoles();
    if (empty($roles)) {
        continue; // Skip contributors without roles
    }
    $topRole = $roles[0];
    // Close previous section and start new one when role changes
    if ($currentRole !== $topRole->weight):
        if ($currentRole !== null): ?>
            </div>
            </section>
        <?php endif;
        $currentRole = $topRole->weight;
        ?>
        <section class="role-section">
            <h2 class="role-title" style="color: #<?= $topRole->color ?>;">
                <?php // Simple pluralization works for current roles; review if adding new ones ?>
                <?= $topRole->name ?><?php if ($topRole->name !== 'Owner'): ?>s<?php endif ?>
            </h2>
            <div class="contributors-grid">
            <?php endif; ?>
            <a class="contributor-card" href="/cast/<?= $contributor->getId() ?>">
                <img class="contributor-avatar"
                    src="<?= $contributor->getAvatarLink() ?>"
                    onerror="this.onerror=null; this.src=<?= json_encode($contributor->getDefaultAvatarUrl(), JSON_HEX_APOS|JSON_HEX_QUOT|JSON_HEX_TAG|JSON_HEX_AMP) ?>"
                    alt="<?= $contributor->getName() ?>'s profile picture"
                    loading="lazy" />
                <p class="contributor-name"><?= $contributor->getName() ?></p>
                <?php if (!empty($contributor->getLore())): ?>
                    <p class="contributor-lore"><?= $contributor->getLore() ?></p>
                <?php endif ?>
            </a>

        <?php endforeach; ?>

        <?php if ($currentRole !== null): ?>
        </div>
    </section>
<?php endif; ?>