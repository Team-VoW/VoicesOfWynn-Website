<header class="credits-header">
    <h1>Contributors</h1>
    <p>A lot of people worked hard on this mod. Take a moment to appreciate their work.</p>
</header>

<?php
$currentRole = null;
foreach (${basename(__FILE__, '.phtml').'_contributors'} as $contributor) :
    $topRole = $contributor->getRoles()[0];

    // Close previous section and start new one when role changes
    if ($currentRole !== $topRole->weight) :
        if ($currentRole !== null) : ?>
            </div>
        </section>
        <?php endif;
        $currentRole = $topRole->weight;
        ?>
        <section class="role-section">
            <h2 class="role-title" style="color: #<?= htmlspecialchars($topRole->color, ENT_QUOTES, 'UTF-8') ?>;">
                <?= htmlspecialchars($topRole->name, ENT_QUOTES, 'UTF-8') ?><?php if ($topRole->name !== 'Owner') : ?>s<?php endif ?>
            </h2>
            <div class="contributors-grid">
    <?php endif; ?>

    <a class="contributor-card" href="/cast/<?= $contributor->getId(); ?>">
        <img
            class="contributor-avatar"
            src="<?= $contributor->getAvatarLink(); ?>"
            onerror="this.onerror=null; this.src='<?= $contributor->getDefaultAvatarUrl(); ?>'"
            alt="<?= htmlspecialchars($contributor->getName()); ?>'s profile picture"
            loading="lazy"
        />
        <p class="contributor-name"><?= htmlspecialchars($contributor->getName()); ?></p>
        <?php if (!empty($contributor->getLore())) : ?>
            <p class="contributor-lore"><?= htmlspecialchars($contributor->getLore()); ?></p>
        <?php endif ?>
    </a>

<?php endforeach; ?>

<?php if ($currentRole !== null) : ?>
            </div>
        </section>
<?php endif; ?>
