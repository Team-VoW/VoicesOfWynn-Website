<header class="credits-header">
    <h1>Contributors</h1>
    <p>A lot of people worked hard on this mod. Take a moment to appreciate their work.</p>
</header>

<?php
$currentRole = null;
foreach (${basename(__FILE__, '.phtml') . '_contributors'} as $contributor):
    $roles = $contributor->getRoles();
    if (empty($roles)) {
        continue; // Skip contributors without roles
    }
    $topRole = $roles[0];
    // Close previous section and start new one when role changes
    if ($currentRole !== $topRole->weight):
        if ($currentRole !== null): ?>
            </div>
            </section>
        <?php endif;
        $currentRole = $topRole->weight;
        ?>
        <section class="role-section">
            <h2 class="role-title" style="color: #<?= htmlspecialchars($topRole->color, ENT_QUOTES, 'UTF-8') ?>;">
                <?php // Simple pluralization works for current roles; review if adding new ones ?>
                <?= htmlspecialchars($topRole->name, ENT_QUOTES, 'UTF-8') ?>
                <?php if ($topRole->name !== 'Owner'): ?>s<?php endif ?>
            </h2>
            <div class="contributors-grid">
            <?php endif; ?>
            <a class="contributor-card" href="/cast/<?= htmlspecialchars($contributor->getId(), ENT_QUOTES, 'UTF-8'); ?>">
                <img class="contributor-avatar"
                    src="<?= htmlspecialchars($contributor->getAvatarLink(), ENT_QUOTES, 'UTF-8'); ?>"
                    onerror="this.onerror=null; this.src='<?= htmlspecialchars($contributor->getDefaultAvatarUrl(), ENT_QUOTES, 'UTF-8') ?>'"
                    alt="<?= htmlspecialchars($contributor->getName(), ENT_QUOTES, 'UTF-8'); ?>'s profile picture"
                    loading="lazy" />
                <p class="contributor-name"><?= htmlspecialchars($contributor->getName(), ENT_QUOTES, 'UTF-8'); ?></p>
                <?php if (!empty($contributor->getLore())): ?>
                    <p class="contributor-lore"><?= htmlspecialchars($contributor->getLore(), ENT_QUOTES, 'UTF-8'); ?></p>
                <?php endif ?>
            </a>

        <?php endforeach; ?>

        <?php if ($currentRole !== null): ?>
        </div>
    </section>
<?php endif; ?>